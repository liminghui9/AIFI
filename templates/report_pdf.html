<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è´¢åŠ¡åˆ†ææŠ¥å‘Š - {{ report.basic_info.get('ä¼ä¸šåç§°', 'ä¼ä¸š') }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SimSun', 'Microsoft YaHei', serif;
            font-size: 11pt;
            line-height: 1.8;
            color: #333;
            background: #fff;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* å°é¢ */
        .cover-page {
            page-break-after: always;
            height: 27cm;
            background: #667eea;
            color: white;
            text-align: center;
            padding-top: 8cm;
        }
        
        .cover-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .cover-subtitle {
            font-size: 24px;
            margin-bottom: 40px;
        }
        
        .cover-company {
            font-size: 32px;
            margin: 40px 0;
            padding: 20px 40px;
            border: 3px solid white;
            border-radius: 10px;
        }
        
        .cover-date {
            font-size: 18px;
            margin-top: 40px;
        }
        
        /* é¡µçœ‰é¡µè„š */
        @page {
            margin: 2cm 1.5cm;
            @top-center {
                content: "ä¼ä¸šè´¢åŠ¡åˆ†ææŠ¥å‘Š";
                font-size: 10px;
                color: #666;
            }
            @bottom-center {
                content: counter(page);
                font-size: 10px;
                color: #666;
            }
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            font-size: 18pt;
            color: #667eea;
            margin: 20pt 0 15pt;
            padding-bottom: 8pt;
            border-bottom: 2pt solid #667eea;
            page-break-after: avoid;
            font-weight: bold;
        }
        
        h2 {
            font-size: 16pt;
            color: #764ba2;
            margin: 18pt 0 12pt;
            page-break-after: avoid;
            font-weight: bold;
        }
        
        h3 {
            font-size: 14pt;
            color: #333;
            margin: 15pt 0 10pt;
            page-break-after: avoid;
            font-weight: bold;
        }
        
        h4 {
            font-size: 12pt;
            color: #555;
            margin: 12pt 0 8pt;
            font-weight: bold;
            page-break-after: avoid;
        }
        
        h5 {
            font-size: 11pt;
            color: #666;
            margin: 10pt 0 6pt;
            font-weight: bold;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .report-card {
            background: white;
            padding: 15pt;
            margin-bottom: 15pt;
            border: 1pt solid #e0e0e0;
            page-break-inside: avoid;
        }
        
        .overall-assessment {
            background: #f5f7ff;
            border-left: 3pt solid #667eea;
            padding: 15pt;
        }
        
        .dimension-card {
            border-left: 3pt solid #764ba2;
            margin-top: 12pt;
            padding: 12pt;
            background: #fafafa;
            page-break-inside: auto;  /* å…è®¸è·¨é¡µ */
        }
        
        .dimension-card h2 {
            page-break-after: avoid;  /* æ ‡é¢˜åä¸åˆ†é¡µ */
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10pt 0;
            font-size: 10pt;
            page-break-inside: auto;
        }
        
        thead {
            background: #667eea;
            color: white;
        }
        
        th {
            padding: 8pt;
            text-align: left;
            font-weight: bold;
            border: 1pt solid #ddd;
        }
        
        td {
            padding: 6pt 8pt;
            border: 1pt solid #e0e0e0;
        }
        
        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .info-table td:first-child {
            background: #f5f7ff;
            font-weight: bold;
            width: 35%;
        }
        
        /* AIåˆ†ææ–‡æœ¬ */
        .analysis-text {
            background: #f0f5ff;
            border-left: 3pt solid #667eea;
            padding: 12pt;
            margin: 10pt 0;
            line-height: 1.8;
        }
        
        .analysis-text strong {
            color: #667eea;
            font-weight: bold;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            margin: 12pt 0;
            padding: 10pt;
            background: white;
            border: 1pt solid #e0e0e0;
            page-break-inside: avoid;
            text-align: center;
        }
        
        .chart-container h4 {
            margin: 0 0 8pt 0;
            color: #764ba2;
            font-size: 11pt;
        }
        
        .chart-container img {
            width: 95%;
            max-width: 550pt;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        .chart-container p {
            margin: 40pt 0;
            color: #999;
            font-size: 10pt;
        }
        
        /* æ–‡æœ¬é¢œè‰² */
        .text-success {
            color: #27ae60;
            font-weight: 600;
        }
        
        .text-danger {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .text-muted {
            color: #999;
        }
        
        /* å›¾æ ‡æ›¿ä»£ */
        .icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        /* åˆ†é¡µæ§åˆ¶ */
        .page-break {
            page-break-after: always;
        }
        
        .avoid-break {
            page-break-inside: avoid;
        }
        
        /* ç›®å½•æ ·å¼ */
        .toc {
            page-break-after: always;
        }
        
        .toc-item {
            padding: 10px 0;
            border-bottom: 1px dotted #ddd;
        }
        
        .toc-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- å°é¢é¡µ -->
    <div class="cover-page">
        <div class="cover-title">ä¼ä¸šè´¢åŠ¡åˆ†ææŠ¥å‘Š</div>
        <div class="cover-subtitle">Financial Analysis Report</div>
        <div class="cover-company">{{ report.basic_info.get('ä¼ä¸šåç§°', 'ä¼ä¸šåç§°') }}</div>
        <div class="cover-date">ç”Ÿæˆæ—¥æœŸï¼š{{ report.generated_at }}</div>
        <div class="cover-date" style="margin-top: 10px;">AIFI æ™ºèƒ½è´¢æŠ¥ç³»ç»Ÿ</div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="container">
        <!-- ä¸€ã€ä¼ä¸šåŸºæœ¬ä¿¡æ¯ -->
        <div class="report-card">
            <h1>ä¸€ã€ä¼ä¸šåŸºæœ¬ä¿¡æ¯</h1>
            <table class="info-table">
                {% for key, value in report.basic_info.items() %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ value }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <!-- äºŒã€æ€»ä½“é£é™©è¯„ä¼° -->
        <div class="report-card overall-assessment">
            <h1>äºŒã€æ€»ä½“é£é™©è¯„ä¼°</h1>
            <div style="white-space: pre-line; line-height: 1.8;">{{ report.overall_assessment }}</div>
            
            <!-- æ€»è§ˆå›¾è¡¨ -->
            {% if report.charts %}
                {% if report.charts.get('health_dashboard_png') %}
                <div class="avoid-break">
                    <h3>è´¢åŠ¡å¥åº·åº¦æ€»è§ˆ</h3>
                    <div class="chart-container">
                        <img src="file:///{{ report.charts.get('health_dashboard_png')|replace('\\', '/') }}" alt="è´¢åŠ¡å¥åº·åº¦ä»ªè¡¨ç›˜">
                    </div>
                </div>
                {% endif %}
                
                {% if report.charts.get('main_indicators_png') %}
                <div class="avoid-break">
                    <h3>ä¸»è¦æŒ‡æ ‡å¯¹æ¯”</h3>
                    <div class="chart-container">
                        <img src="file:///{{ report.charts.get('main_indicators_png')|replace('\\', '/') }}" alt="ä¸»è¦æŒ‡æ ‡å¯¹æ¯”">
                    </div>
                </div>
                {% endif %}
                
                {% if report.charts.get('risk_radar_png') %}
                <div class="avoid-break">
                    <h3>é£é™©é›·è¾¾å›¾</h3>
                    <div class="chart-container">
                        <img src="file:///{{ report.charts.get('risk_radar_png')|replace('\\', '/') }}" alt="é£é™©é›·è¾¾å›¾">
                    </div>
                </div>
                {% endif %}
            {% endif %}
        </div>

        <!-- ä¸‰ã€åˆ†ç»´åº¦é£é™©åˆ†æ -->
        <div class="report-card">
            <h1>ä¸‰ã€åˆ†ç»´åº¦é£é™©åˆ†æ</h1>
            
            {% set dimensions = ['ç›ˆåˆ©é£é™©', 'å¿å€ºé£é™©', 'è¿è¥é£é™©', 'ç°é‡‘æµé£é™©'] %}
            {% set chart_keys = ['profitability', 'solvency', 'operational', 'cashflow'] %}
            
            {% for dimension in dimensions %}
            {% if loop.index == 3 %}
            <!-- ç¬¬ä¸‰ä¸ªç»´åº¦å‰å»ºè®®åˆ†é¡µ -->
            <div style="page-break-before: always;"></div>
            {% endif %}
            
            <div class="dimension-card">
                <h2>3.{{ loop.index }} {{ dimension }}</h2>
                
                <!-- æŒ‡æ ‡è¡¨æ ¼ -->
                {% if report.years %}
                <table>
                    <thead>
                        <tr>
                            <th>æŒ‡æ ‡åç§°</th>
                            <th>{{ report.years[0] }}å¹´</th>
                            {% if report.years|length >= 2 %}
                            <th>{{ report.years[1] }}å¹´</th>
                            <th>å˜åŒ–</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% set current_year = report.years[0] %}
                        {% set indicators = report.indicators[current_year][dimension] %}
                        
                        {% for indicator_name, value in indicators.items() %}
                        <tr>
                            <td><strong>{{ indicator_name }}</strong></td>
                            <td>
                                {% if value is not none %}
                                    {% if indicator_name in ['å‡€åˆ©æ¶¦ç‡', 'æ¯›åˆ©ç‡', 'å‡€èµ„äº§æ”¶ç›Šç‡', 'èµ„äº§è´Ÿå€ºç‡'] %}
                                        {{ "%.2f"|format(value) }}%
                                    {% elif indicator_name in ['ç»è¥æ€§å‡€ç°é‡‘æµ', 'ç°é‡‘å‡€å¢åŠ é¢'] %}
                                        {{ "{:,.2f}".format(value) }} ä¸‡å…ƒ
                                    {% else %}
                                        {{ "%.2f"|format(value) }}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">æ•°æ®ç¼ºå¤±</span>
                                {% endif %}
                            </td>
                            
                            {% if report.years|length >= 2 %}
                            {% set prev_year = report.years[1] %}
                            {% set prev_value = report.indicators[prev_year][dimension][indicator_name] %}
                            <td>
                                {% if prev_value is not none %}
                                    {% if indicator_name in ['å‡€åˆ©æ¶¦ç‡', 'æ¯›åˆ©ç‡', 'å‡€èµ„äº§æ”¶ç›Šç‡', 'èµ„äº§è´Ÿå€ºç‡'] %}
                                        {{ "%.2f"|format(prev_value) }}%
                                    {% elif indicator_name in ['ç»è¥æ€§å‡€ç°é‡‘æµ', 'ç°é‡‘å‡€å¢åŠ é¢'] %}
                                        {{ "{:,.2f}".format(prev_value) }} ä¸‡å…ƒ
                                    {% else %}
                                        {{ "%.2f"|format(prev_value) }}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">æ•°æ®ç¼ºå¤±</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if value is not none and prev_value is not none %}
                                    {% set change = value - prev_value %}
                                    {% if change > 0 %}
                                        <span class="text-success">â†‘ {{ "%.2f"|format(change) }}</span>
                                    {% elif change < 0 %}
                                        <span class="text-danger">â†“ {{ "%.2f"|format(change) }}</span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
                
                <!-- AIåˆ†æ -->
                <div class="analysis-text">
                    <strong>ğŸ¤– AIåˆ†æï¼š</strong><br>
                    {{ report.dimension_analyses[dimension] }}
                </div>
                
                <!-- ç»´åº¦å›¾è¡¨ -->
                {% if report.charts %}
                    {% set chart_key = chart_keys[loop.index0] + '_png' %}
                    {% if report.charts.get(chart_key) %}
                    <div class="chart-container">
                        <h4>æ•°æ®å¯è§†åŒ–</h4>
                        <img src="file:///{{ report.charts.get(chart_key)|replace('\\', '/') }}" alt="{{ dimension }}å¯è§†åŒ–å›¾è¡¨">
                    </div>
                    {% endif %}
                {% endif %}
            </div>
            
            {% if not loop.last %}
            <div style="margin: 30px 0;"></div>
            {% endif %}
            {% endfor %}
        </div>

        <!-- å››ã€è´¢åŠ¡æŠ¥è¡¨æ•°æ® -->
        <div class="report-card page-break">
            <h1>å››ã€è´¢åŠ¡æŠ¥è¡¨æ•°æ®ï¼ˆç²¾ç®€ç‰ˆï¼‰</h1>
            
            <!-- èµ„äº§è´Ÿå€ºè¡¨ -->
            <h2>4.1 èµ„äº§è´Ÿå€ºè¡¨</h2>
            {% if report.years %}
            <table>
                <thead>
                    <tr>
                        <th>é¡¹ç›®</th>
                        <th>{{ report.years[0] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% if report.years|length >= 2 %}
                        <th>{{ report.years[1] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% set balance_data = report.financial_data[report.years[0]]['èµ„äº§è´Ÿå€ºè¡¨'] %}
                    {% for item, value in balance_data.items() %}
                    <tr>
                        <td>{{ item }}</td>
                        <td>{{ "{:,.2f}".format(value) if value is not none else '-' }}</td>
                        {% if report.years|length >= 2 %}
                        {% set prev_value = report.financial_data[report.years[1]]['èµ„äº§è´Ÿå€ºè¡¨'].get(item) %}
                        <td>{{ "{:,.2f}".format(prev_value) if prev_value is not none else '-' }}</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
            
            <!-- åˆ©æ¶¦è¡¨ -->
            <h2>4.2 åˆ©æ¶¦è¡¨</h2>
            {% if report.years %}
            <table>
                <thead>
                    <tr>
                        <th>é¡¹ç›®</th>
                        <th>{{ report.years[0] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% if report.years|length >= 2 %}
                        <th>{{ report.years[1] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% set income_data = report.financial_data[report.years[0]]['åˆ©æ¶¦è¡¨'] %}
                    {% for item, value in income_data.items() %}
                    <tr>
                        <td>{{ item }}</td>
                        <td>{{ "{:,.2f}".format(value) if value is not none else '-' }}</td>
                        {% if report.years|length >= 2 %}
                        {% set prev_value = report.financial_data[report.years[1]]['åˆ©æ¶¦è¡¨'].get(item) %}
                        <td>{{ "{:,.2f}".format(prev_value) if prev_value is not none else '-' }}</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
            
            <!-- ç°é‡‘æµé‡è¡¨ -->
            <h2>4.3 ç°é‡‘æµé‡è¡¨</h2>
            {% if report.years %}
            <table>
                <thead>
                    <tr>
                        <th>é¡¹ç›®</th>
                        <th>{{ report.years[0] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% if report.years|length >= 2 %}
                        <th>{{ report.years[1] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% set cashflow_data = report.financial_data[report.years[0]]['ç°é‡‘æµé‡è¡¨'] %}
                    {% for item, value in cashflow_data.items() %}
                    <tr>
                        <td>{{ item }}</td>
                        <td>{{ "{:,.2f}".format(value) if value is not none else '-' }}</td>
                        {% if report.years|length >= 2 %}
                        {% set prev_value = report.financial_data[report.years[1]]['ç°é‡‘æµé‡è¡¨'].get(item) %}
                        <td>{{ "{:,.2f}".format(prev_value) if prev_value is not none else '-' }}</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>

        <!-- æŠ¥å‘Šè¯´æ˜ -->
        <div class="report-card" style="margin-top: 40px; background: #f8f9fa;">
            <h3>æŠ¥å‘Šè¯´æ˜</h3>
            <p style="line-height: 1.8; color: #666; margin: 10px 0;">
                1. æœ¬æŠ¥å‘Šç”± AIFI æ™ºèƒ½è´¢æŠ¥ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ<br>
                2. æŠ¥å‘Šæ•°æ®æ¥æºäºä¸Šä¼ çš„ä¼ä¸šè´¢åŠ¡æŠ¥è¡¨<br>
                3. AIåˆ†æåŸºäºå¤§è¯­è¨€æ¨¡å‹è¿›è¡Œé£é™©è¯„ä¼°ï¼Œä»…ä¾›å‚è€ƒ<br>
                4. å®Œæ•´çš„äº¤äº’å¼å›¾è¡¨è¯·è®¿é—®åœ¨çº¿ç‰ˆæœ¬æŸ¥çœ‹<br>
                5. å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜
            </p>
        </div>
    </div>
</body>
</html>

