<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è´¢åŠ¡åˆ†ææŠ¥å‘Š - {{ report.basic_info.get('ä¼ä¸šåç§°', 'ä¼ä¸š') }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SimSun', 'Microsoft YaHei', serif;
            font-size: 11pt;
            line-height: 1.8;
            color: #333;
            background: #fff;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* å°é¢ - ä¸“ä¸šè“è‰²ç§‘æŠ€é£ */
        .cover-page {
            page-break-after: always;
            height: 29.7cm;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%);
            color: white;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 80px 60px;
        }
        
        .cover-pattern {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.03) 35px, rgba(255,255,255,.03) 70px);
            z-index: 0;
        }
        
        .cover-logo {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 4px;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }
        
        .cover-logo-sub {
            font-size: 12px;
            letter-spacing: 6px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .cover-main {
            text-align: center;
            position: relative;
            z-index: 1;
            padding: 60px 0;
        }
        
        .cover-title {
            font-size: 56px;
            font-weight: 700;
            margin-bottom: 30px;
            letter-spacing: 6px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .cover-subtitle {
            font-size: 20px;
            letter-spacing: 8px;
            opacity: 0.9;
            margin-bottom: 60px;
            text-transform: uppercase;
        }
        
        .cover-company {
            font-size: 38px;
            font-weight: 700;
            margin: 50px auto;
            padding: 35px 60px;
            max-width: 700px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            letter-spacing: 3px;
        }
        
        .cover-footer {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            position: relative;
            z-index: 1;
        }
        
        .cover-date {
            font-size: 14px;
            opacity: 0.9;
            margin: 6px 0;
        }
        
        .cover-watermark {
            position: absolute;
            bottom: 40px;
            right: 60px;
            font-size: 140px;
            opacity: 0.04;
            font-weight: 900;
            letter-spacing: 10px;
            transform: rotate(-12deg);
            z-index: 0;
        }
        
        /* é¡µçœ‰é¡µè„š */
        @page {
            margin: 2cm 1.5cm;
            @top-center {
                content: "ä¼ä¸šè´¢åŠ¡åˆ†ææŠ¥å‘Š";
                font-size: 10px;
                color: #666;
            }
            @bottom-center {
                content: counter(page);
                font-size: 10px;
                color: #666;
            }
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            font-size: 20pt;
            color: #1e3a8a;
            margin: 25pt 0 18pt;
            padding: 15pt 20pt;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-left: 5pt solid #3b82f6;
            border-radius: 0 8pt 8pt 0;
            page-break-after: avoid;
            font-weight: 700;
        }
        
        h2 {
            font-size: 16pt;
            color: #0f172a;
            margin: 20pt 0 14pt;
            padding-left: 15pt;
            border-left: 4pt solid #06b6d4;
            page-break-after: avoid;
            font-weight: 700;
        }
        
        h3 {
            font-size: 14pt;
            color: #0f172a;
            margin: 18pt 0 12pt;
            page-break-after: avoid;
            font-weight: 700;
        }
        
        h4 {
            font-size: 12pt;
            color: #555;
            margin: 12pt 0 8pt;
            font-weight: bold;
            page-break-after: avoid;
        }
        
        h5 {
            font-size: 11pt;
            color: #666;
            margin: 10pt 0 6pt;
            font-weight: bold;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .report-card {
            background: white;
            padding: 20pt;
            margin-bottom: 20pt;
            border: 1pt solid #e2e8f0;
            border-radius: 10pt;
            box-shadow: 0 2pt 8pt rgba(0, 0, 0, 0.05);
            page-break-inside: auto;  /* å…è®¸åˆ†é¡µ */
        }
        
        .overall-assessment {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 25pt;
            border-radius: 12pt;
            box-shadow: 0 4pt 20pt rgba(59, 130, 246, 0.3);
            page-break-inside: auto;  /* å…è®¸å†…éƒ¨åˆ†é¡µ */
        }
        
        .overall-assessment h1 {
            color: white;
            background: transparent;
            border: none;
            padding: 0;
            margin-bottom: 20pt;
        }
        
        .overall-assessment h3 {
            color: white;
        }
        
        .overall-assessment h5 {
            color: rgba(255, 255, 255, 0.95);
        }
        
        .overall-assessment .chart-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .overall-assessment .chart-container h3,
        .overall-assessment .chart-container h5 {
            color: white;
        }
        
        .dimension-card {
            border-left: 5pt solid #3b82f6;
            margin: 20pt 0;
            padding: 20pt;
            background: white;
            border-radius: 10pt;
            box-shadow: 0 2pt 8pt rgba(59, 130, 246, 0.1);
            page-break-inside: auto;  /* å…è®¸è·¨é¡µ */
        }
        
        .dimension-card h2 {
            page-break-after: avoid;  /* æ ‡é¢˜åä¸åˆ†é¡µ */
            color: #1e3a8a;
            border-left: none;
            padding-left: 0;
            margin-top: 0;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10pt 0;
            font-size: 10pt;
            page-break-inside: auto;
        }
        
        thead {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
        }
        
        th {
            padding: 8pt;
            text-align: left;
            font-weight: bold;
            border: 1pt solid #ddd;
        }
        
        td {
            padding: 6pt 8pt;
            border: 1pt solid #e0e0e0;
        }
        
        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .info-table td:first-child {
            background: #f5f7ff;
            font-weight: bold;
            width: 35%;
        }
        
        /* AIåˆ†ææ–‡æœ¬ */
        .analysis-text {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4pt solid #3b82f6;
            padding: 15pt 18pt;
            margin: 15pt 0;
            line-height: 2;
            border-radius: 0 8pt 8pt 0;
        }
        
        .analysis-text strong {
            color: #1e3a8a;
            font-weight: 700;
            font-size: 11pt;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            margin: 18pt 0;
            padding: 15pt;
            background: #f8fafc;
            border: 1pt solid #e2e8f0;
            border-radius: 8pt;
            page-break-inside: auto;  /* å…è®¸å›¾è¡¨åˆ†é¡µ */
            text-align: center;
        }
        
        .chart-container h4 {
            margin: 0 0 12pt 0;
            color: #1e3a8a;
            font-size: 12pt;
            font-weight: 700;
        }
        
        .chart-container h5 {
            margin: 0 0 10pt 0;
            color: #0f172a;
            font-size: 11pt;
            font-weight: 600;
        }
        
        .chart-container img {
            width: 95%;
            max-width: 550pt;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        .chart-container p {
            margin: 40pt 0;
            color: #999;
            font-size: 10pt;
        }
        
        /* æ–‡æœ¬é¢œè‰² */
        .text-success {
            color: #10b981;
            font-weight: 600;
        }
        
        .text-danger {
            color: #ef4444;
            font-weight: 600;
        }
        
        .text-warning {
            color: #f59e0b;
            font-weight: 600;
        }
        
        .text-muted {
            color: #94a3b8;
        }
        
        /* é¢„è­¦å¾½ç« æ ·å¼ */
        .alert-badge {
            display: inline-block;
            padding: 3pt 10pt;
            border-radius: 12pt;
            font-size: 8pt;
            font-weight: 700;
            margin-right: 6pt;
        }
        
        .alert-badge.success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
        }
        
        .alert-badge.warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
        }
        
        .alert-badge.danger {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
        }
        
        .alert-value {
            color: #3b82f6;
            font-weight: 600;
        }
        
        .alert-note {
            color: #64748b;
            font-size: 9pt;
            line-height: 1.6;
        }
        
        /* å›¾æ ‡æ›¿ä»£ */
        .icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        /* åˆ†é¡µæ§åˆ¶ */
        .page-break {
            page-break-after: always;
        }
        
        .page-break-before {
            page-break-before: always;
        }
        
        .avoid-break {
            page-break-inside: auto;  /* å…è®¸åˆ†é¡µï¼Œé¿å…å¤§æ®µç©ºç™½ */
        }
        
        /* ç›®å½•æ ·å¼ */
        .toc {
            page-break-after: always;
        }
        
        .toc-item {
            padding: 10px 0;
            border-bottom: 1px dotted #ddd;
        }
        
        .toc-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- å°é¢é¡µ -->
    <div class="cover-page">
        <div class="cover-pattern"></div>
        <div class="cover-watermark">AIFI</div>
        
        <div style="position: relative; z-index: 1;">
            <div class="cover-logo">âš¡ AIFI</div>
            <div class="cover-logo-sub">FINANCIAL INTELLIGENCE SYSTEM</div>
        </div>
        
        <div class="cover-main">
            <div class="cover-title">ä¼ä¸šè´¢åŠ¡åˆ†ææŠ¥å‘Š</div>
            <div class="cover-subtitle">Financial Analysis Report</div>
            <div class="cover-company">{{ report.basic_info.get('ä¼ä¸šåç§°', 'ä¼ä¸šåç§°') }}</div>
        </div>
        
        <div class="cover-footer">
            <div>
                <div class="cover-date">ğŸ“… ç”Ÿæˆæ—¥æœŸï¼š{{ report.generated_at }}</div>
                <div class="cover-date">ğŸ“Š åˆ†æå¹´åº¦ï¼š{{ report.years[0] if report.years else '-' }}å¹´</div>
                <div class="cover-date">ğŸ“ˆ æŠ¥å‘Šç±»å‹ï¼šç»¼åˆè´¢åŠ¡åˆ†æ</div>
            </div>
            <div style="text-align: right; font-size: 11px; opacity: 0.85;">
                <div>Powered by AI Technology</div>
                <div style="margin-top: 5px;">æ™ºèƒ½è´¢åŠ¡åˆ†æç³»ç»Ÿ</div>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="container">
        <!-- ä¸€ã€ä¼ä¸šåŸºæœ¬ä¿¡æ¯ -->
        <div class="report-card">
            <h1>ä¸€ã€ä¼ä¸šåŸºæœ¬ä¿¡æ¯</h1>
            <table class="info-table">
                {% for key, value in report.basic_info.items() %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ value }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <!-- äºŒã€æ€»ä½“é£é™©è¯„ä¼° -->
        <div class="report-card overall-assessment">
            <h1>äºŒã€æ€»ä½“é£é™©è¯„ä¼°</h1>
            <div style="white-space: pre-line; line-height: 1.8;">{{ report.overall_assessment }}</div>
            
            <!-- æ€»è§ˆå›¾è¡¨ -->
            {% if report.charts %}
                {% if report.charts.get('health_dashboard_png') %}
                <h3>è´¢åŠ¡å¥åº·åº¦æ€»è§ˆ</h3>
                <div class="chart-container">
                    <img src="file:///{{ report.charts.get('health_dashboard_png')|replace('\\', '/') }}" alt="è´¢åŠ¡å¥åº·åº¦ä»ªè¡¨ç›˜">
                </div>
                {% endif %}
                
                {% if report.charts.get('main_indicators_png') %}
                <h3>ä¸»è¦æŒ‡æ ‡å¯¹æ¯”</h3>
                <div class="chart-container">
                    <img src="file:///{{ report.charts.get('main_indicators_png')|replace('\\', '/') }}" alt="ä¸»è¦æŒ‡æ ‡å¯¹æ¯”">
                </div>
                {% endif %}
                
                {% if report.charts.get('risk_radar_png') %}
                <h3>é£é™©é›·è¾¾å›¾</h3>
                <div class="chart-container">
                    <img src="file:///{{ report.charts.get('risk_radar_png')|replace('\\', '/') }}" alt="é£é™©é›·è¾¾å›¾">
                </div>
                {% endif %}
            {% endif %}
        </div>

        <!-- ä¸‰ã€åˆ†ç»´åº¦é£é™©åˆ†æ -->
        <div class="report-card">
            <h1>ä¸‰ã€åˆ†ç»´åº¦é£é™©åˆ†æ</h1>
            
            {% set dimensions = ['ç›ˆåˆ©é£é™©', 'å¿å€ºé£é™©', 'è¿è¥é£é™©', 'ç°é‡‘æµé£é™©'] %}
            {% set chart_keys = ['profitability', 'solvency', 'operational', 'cashflow'] %}
            
            {% for dimension in dimensions %}
            <div class="dimension-card">
                <h2>3.{{ loop.index }} {{ dimension }}</h2>
                
                <!-- æŒ‡æ ‡è¡¨æ ¼ -->
                {% if report.years %}
                <table>
                    <thead>
                        <tr>
                            <th style="width: 25%;">æŒ‡æ ‡åç§°</th>
                            <th style="width: 18%;">{{ report.years[0] }}å¹´</th>
                            {% if report.years|length >= 2 %}
                            <th style="width: 18%;">{{ report.years[1] }}å¹´</th>
                            <th style="width: 15%;">å˜åŒ–</th>
                            {% endif %}
                            <th style="width: 12%;">é¢„è­¦å€¼</th>
                            <th style="width: 12%;">é£é™©ç­‰çº§</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set current_year = report.years[0] %}
                        {% set indicators = report.indicators[current_year][dimension] %}
                        
                        {% for indicator_name, value in indicators.items() %}
                        <tr>
                            <td><strong>{{ indicator_name }}</strong></td>
                            <td>
                                {% if value is not none %}
                                    {% if indicator_name in ['å‡€åˆ©æ¶¦ç‡', 'æ¯›åˆ©ç‡', 'å‡€èµ„äº§æ”¶ç›Šç‡', 'èµ„äº§è´Ÿå€ºç‡'] %}
                                        {{ "%.2f"|format(value) }}%
                                    {% elif indicator_name in ['ç»è¥æ€§å‡€ç°é‡‘æµ', 'ç°é‡‘å‡€å¢åŠ é¢'] %}
                                        {{ "{:,.2f}".format(value) }} ä¸‡å…ƒ
                                    {% else %}
                                        {{ "%.2f"|format(value) }}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">æ•°æ®ç¼ºå¤±</span>
                                {% endif %}
                            </td>
                            
                            {% if report.years|length >= 2 %}
                            {% set prev_year = report.years[1] %}
                            {% set prev_value = report.indicators[prev_year][dimension][indicator_name] %}
                            <td>
                                {% if prev_value is not none %}
                                    {% if indicator_name in ['å‡€åˆ©æ¶¦ç‡', 'æ¯›åˆ©ç‡', 'å‡€èµ„äº§æ”¶ç›Šç‡', 'èµ„äº§è´Ÿå€ºç‡'] %}
                                        {{ "%.2f"|format(prev_value) }}%
                                    {% elif indicator_name in ['ç»è¥æ€§å‡€ç°é‡‘æµ', 'ç°é‡‘å‡€å¢åŠ é¢'] %}
                                        {{ "{:,.2f}".format(prev_value) }} ä¸‡å…ƒ
                                    {% else %}
                                        {{ "%.2f"|format(prev_value) }}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">æ•°æ®ç¼ºå¤±</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if value is not none and prev_value is not none %}
                                    {% set change = value - prev_value %}
                                    {% if change > 0 %}
                                        <span class="text-success">â†‘ {{ "%.2f"|format(change) }}</span>
                                    {% elif change < 0 %}
                                        <span class="text-danger">â†“ {{ "%.2f"|format(change) }}</span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            {% endif %}
                            
                            <!-- é¢„è­¦å€¼åˆ— -->
                            <td style="text-align: center; font-size: 9pt;">
                                <span class="alert-value">
                                {% if dimension == 'ç›ˆåˆ©é£é™©' %}
                                    {% if indicator_name == 'å‡€åˆ©æ¶¦ç‡' %}<5%
                                    {% elif indicator_name == 'æ¯›åˆ©ç‡' %}<20%
                                    {% elif indicator_name == 'å‡€èµ„äº§æ”¶ç›Šç‡' %}<8%
                                    {% elif indicator_name in ['è¥ä¸šæ”¶å…¥å¢é•¿ç‡', 'å‡€åˆ©æ¶¦å¢é•¿ç‡'] %}<0%
                                    {% else %}-{% endif %}
                                {% elif dimension == 'å¿å€ºé£é™©' %}
                                    {% if indicator_name == 'èµ„äº§è´Ÿå€ºç‡' %}>70%
                                    {% elif indicator_name == 'æµåŠ¨æ¯”ç‡' %}<1.5
                                    {% elif indicator_name == 'é€ŸåŠ¨æ¯”ç‡' %}<1.0
                                    {% elif indicator_name == 'ç°é‡‘æ¯”ç‡' %}<0.5
                                    {% elif indicator_name == 'åˆ©æ¯ä¿éšœå€æ•°' %}<3
                                    {% else %}-{% endif %}
                                {% elif dimension == 'è¿è¥é£é™©' %}
                                    {% if indicator_name == 'æ€»èµ„äº§å‘¨è½¬ç‡' %}<0.8
                                    {% elif indicator_name == 'åº”æ”¶è´¦æ¬¾å‘¨è½¬ç‡' %}<5
                                    {% elif indicator_name == 'å­˜è´§å‘¨è½¬ç‡' %}<3
                                    {% elif indicator_name == 'è¥ä¸šå‘¨æœŸ' %}>120å¤©
                                    {% else %}-{% endif %}
                                {% elif dimension == 'ç°é‡‘æµé£é™©' %}
                                    {% if indicator_name == 'ç»è¥æ€§å‡€ç°é‡‘æµ' %}<0
                                    {% elif indicator_name == 'ç°é‡‘å‡€å¢åŠ é¢' %}<0
                                    {% elif indicator_name == 'ç°é‡‘æµé‡æ¯”ç‡' %}<1.0
                                    {% elif indicator_name == 'é”€å”®ç°é‡‘æ¯”ç‡' %}<0.5
                                    {% else %}-{% endif %}
                                {% else %}-{% endif %}
                                </span>
                            </td>
                            
                            <!-- é£é™©ç­‰çº§åˆ— -->
                            <td style="text-align: center;">
                                {% if value is not none %}
                                    {% set risk_class = 'success' %}
                                    {% set risk_text = 'æ­£å¸¸' %}
                                    {% if dimension == 'ç›ˆåˆ©é£é™©' %}
                                        {% if indicator_name == 'å‡€åˆ©æ¶¦ç‡' and value < 5 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'å‡€åˆ©æ¶¦ç‡' and value < 10 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'æ¯›åˆ©ç‡' and value < 20 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'æ¯›åˆ©ç‡' and value < 30 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'å‡€èµ„äº§æ”¶ç›Šç‡' and value < 8 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'å‡€èµ„äº§æ”¶ç›Šç‡' and value < 15 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name in ['è¥ä¸šæ”¶å…¥å¢é•¿ç‡', 'å‡€åˆ©æ¶¦å¢é•¿ç‡'] and value < 0 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name in ['è¥ä¸šæ”¶å…¥å¢é•¿ç‡', 'å‡€åˆ©æ¶¦å¢é•¿ç‡'] and value < 10 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% endif %}
                                    {% elif dimension == 'å¿å€ºé£é™©' %}
                                        {% if indicator_name == 'èµ„äº§è´Ÿå€ºç‡' and value > 70 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'èµ„äº§è´Ÿå€ºç‡' and value > 60 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'æµåŠ¨æ¯”ç‡' and value < 1 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'æµåŠ¨æ¯”ç‡' and value < 1.5 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'é€ŸåŠ¨æ¯”ç‡' and value < 0.8 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'é€ŸåŠ¨æ¯”ç‡' and value < 1 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'ç°é‡‘æ¯”ç‡' and value < 0.3 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'ç°é‡‘æ¯”ç‡' and value < 0.5 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'åˆ©æ¯ä¿éšœå€æ•°' and value < 2 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'åˆ©æ¯ä¿éšœå€æ•°' and value < 3 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% endif %}
                                    {% elif dimension == 'è¿è¥é£é™©' %}
                                        {% if indicator_name == 'æ€»èµ„äº§å‘¨è½¬ç‡' and value < 0.5 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'æ€»èµ„äº§å‘¨è½¬ç‡' and value < 0.8 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'åº”æ”¶è´¦æ¬¾å‘¨è½¬ç‡' and value < 3 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'åº”æ”¶è´¦æ¬¾å‘¨è½¬ç‡' and value < 5 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'å­˜è´§å‘¨è½¬ç‡' and value < 2 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'å­˜è´§å‘¨è½¬ç‡' and value < 3 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'è¥ä¸šå‘¨æœŸ' and value > 150 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'è¥ä¸šå‘¨æœŸ' and value > 120 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% endif %}
                                    {% elif dimension == 'ç°é‡‘æµé£é™©' %}
                                        {% if indicator_name == 'ç»è¥æ€§å‡€ç°é‡‘æµ' and value < 0 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'ç»è¥æ€§å‡€ç°é‡‘æµ' and value < 50000 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'ç°é‡‘å‡€å¢åŠ é¢' and value < -10000 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'ç°é‡‘å‡€å¢åŠ é¢' and value < 0 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'ç°é‡‘æµé‡æ¯”ç‡' and value < 0.8 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'ç°é‡‘æµé‡æ¯”ç‡' and value < 1 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% elif indicator_name == 'é”€å”®ç°é‡‘æ¯”ç‡' and value < 0.3 %}{% set risk_class = 'danger' %}{% set risk_text = 'é«˜é£é™©' %}
                                        {% elif indicator_name == 'é”€å”®ç°é‡‘æ¯”ç‡' and value < 0.5 %}{% set risk_class = 'warning' %}{% set risk_text = 'ä¸­é£é™©' %}
                                        {% endif %}
                                    {% endif %}
                                    <span class="alert-badge {{ risk_class }}">{{ risk_text }}</span>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
                
                <!-- AIåˆ†æ -->
                <div class="analysis-text">
                    <strong>ğŸ¤– AIåˆ†æï¼š</strong><br>
                    {{ report.dimension_analyses[dimension] }}
                </div>
                
                <!-- ç»´åº¦å›¾è¡¨ -->
                {% if report.charts %}
                    {% set chart_key = chart_keys[loop.index0] + '_png' %}
                    {% if report.charts.get(chart_key) %}
                    <div class="chart-container">
                        <h4>æ•°æ®å¯è§†åŒ–</h4>
                        <img src="file:///{{ report.charts.get(chart_key)|replace('\\', '/') }}" alt="{{ dimension }}å¯è§†åŒ–å›¾è¡¨">
                    </div>
                    {% endif %}
                {% endif %}
            </div>
            
            {% if not loop.last %}
            <div style="margin: 30px 0;"></div>
            {% endif %}
            {% endfor %}
        </div>

        <!-- å››ã€è´¢åŠ¡æŠ¥è¡¨æ•°æ® -->
        <div class="report-card">
            <h1>å››ã€è´¢åŠ¡æŠ¥è¡¨æ•°æ®ï¼ˆç²¾ç®€ç‰ˆï¼‰</h1>
            
            <!-- èµ„äº§è´Ÿå€ºè¡¨ -->
            <h2>4.1 èµ„äº§è´Ÿå€ºè¡¨</h2>
            {% if report.years %}
            <table>
                <thead>
                    <tr>
                        <th>é¡¹ç›®</th>
                        <th>{{ report.years[0] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% if report.years|length >= 2 %}
                        <th>{{ report.years[1] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% set balance_data = report.financial_data[report.years[0]]['èµ„äº§è´Ÿå€ºè¡¨'] %}
                    {% for item, value in balance_data.items() %}
                    <tr>
                        <td>{{ item }}</td>
                        <td>{{ "{:,.2f}".format(value) if value is not none else '-' }}</td>
                        {% if report.years|length >= 2 %}
                        {% set prev_value = report.financial_data[report.years[1]]['èµ„äº§è´Ÿå€ºè¡¨'].get(item) %}
                        <td>{{ "{:,.2f}".format(prev_value) if prev_value is not none else '-' }}</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
            
            <!-- åˆ©æ¶¦è¡¨ -->
            <h2>4.2 åˆ©æ¶¦è¡¨</h2>
            {% if report.years %}
            <table>
                <thead>
                    <tr>
                        <th>é¡¹ç›®</th>
                        <th>{{ report.years[0] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% if report.years|length >= 2 %}
                        <th>{{ report.years[1] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% set income_data = report.financial_data[report.years[0]]['åˆ©æ¶¦è¡¨'] %}
                    {% for item, value in income_data.items() %}
                    <tr>
                        <td>{{ item }}</td>
                        <td>{{ "{:,.2f}".format(value) if value is not none else '-' }}</td>
                        {% if report.years|length >= 2 %}
                        {% set prev_value = report.financial_data[report.years[1]]['åˆ©æ¶¦è¡¨'].get(item) %}
                        <td>{{ "{:,.2f}".format(prev_value) if prev_value is not none else '-' }}</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
            
            <!-- ç°é‡‘æµé‡è¡¨ -->
            <h2>4.3 ç°é‡‘æµé‡è¡¨</h2>
            {% if report.years %}
            <table>
                <thead>
                    <tr>
                        <th>é¡¹ç›®</th>
                        <th>{{ report.years[0] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% if report.years|length >= 2 %}
                        <th>{{ report.years[1] }}å¹´ï¼ˆä¸‡å…ƒï¼‰</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% set cashflow_data = report.financial_data[report.years[0]]['ç°é‡‘æµé‡è¡¨'] %}
                    {% for item, value in cashflow_data.items() %}
                    <tr>
                        <td>{{ item }}</td>
                        <td>{{ "{:,.2f}".format(value) if value is not none else '-' }}</td>
                        {% if report.years|length >= 2 %}
                        {% set prev_value = report.financial_data[report.years[1]]['ç°é‡‘æµé‡è¡¨'].get(item) %}
                        <td>{{ "{:,.2f}".format(prev_value) if prev_value is not none else '-' }}</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>

        <!-- æŠ¥å‘Šè¯´æ˜ -->
        <div class="report-card" style="margin-top: 40px; background: #f8f9fa;">
            <h3>æŠ¥å‘Šè¯´æ˜</h3>
            <p style="line-height: 1.8; color: #666; margin: 10px 0;">
                1. æœ¬æŠ¥å‘Šç”± AIFI æ™ºèƒ½è´¢æŠ¥ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ<br>
                2. æŠ¥å‘Šæ•°æ®æ¥æºäºä¸Šä¼ çš„ä¼ä¸šè´¢åŠ¡æŠ¥è¡¨<br>
                3. AIåˆ†æåŸºäºå¤§è¯­è¨€æ¨¡å‹è¿›è¡Œé£é™©è¯„ä¼°ï¼Œä»…ä¾›å‚è€ƒ<br>
                4. å®Œæ•´çš„äº¤äº’å¼å›¾è¡¨è¯·è®¿é—®åœ¨çº¿ç‰ˆæœ¬æŸ¥çœ‹<br>
                5. å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜
            </p>
        </div>
    </div>
</body>
</html>

