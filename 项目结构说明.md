# AIFI 智能财报系统 - 项目结构说明

## 完整目录结构

```
AIFI智能财报系统/
│
├── app.py                          # Flask主应用程序入口
├── config.py                       # 系统配置管理
├── requirements.txt                # Python依赖包列表
├── .gitignore                      # Git忽略配置
├── .env.template                   # 环境变量配置模板
│
├── modules/                        # 核心功能模块
│   ├── __init__.py                # 模块初始化
│   ├── data_processor.py          # 数据处理模块（Excel解析）
│   ├── indicator_calculator.py    # 财务指标计算模块
│   ├── ai_analyzer.py             # AI风险分析模块
│   ├── report_generator.py        # 报告生成模块
│   └── export_generator.py        # 报告导出模块（Word/PDF）
│
├── templates/                      # HTML模板文件
│   ├── index.html                 # 系统首页（数据上传界面）
│   └── report.html                # 财务报告展示页面
│
├── static/                         # 静态资源目录
│   ├── css/                       # CSS样式文件
│   └── js/                        # JavaScript脚本
│
├── uploads/                        # 上传文件存储目录
│   └── .gitkeep                   # Git占位文件
│
├── exports/                        # 导出报告存储目录
│   └── .gitkeep                   # Git占位文件
│
├── sample_data/                    # 示例数据和模板
│   ├── create_sample_excel.py     # 示例数据生成脚本
│   ├── README.md                  # 数据格式说明
│   └── sample_template.xlsx       # 示例Excel模板（需生成）
│
├── 文档资料/
│   ├── README.md                  # 项目说明文档
│   ├── 使用说明.md                # 详细使用指南
│   ├── 快速开始.txt               # 快速入门指南
│   ├── 项目交付清单.md            # 交付内容清单
│   └── 项目结构说明.md            # 本文档
│
└── 辅助脚本/
    ├── install.bat                # 依赖安装脚本（Windows）
    └── start.bat                  # 快速启动脚本（Windows）
```

## 核心模块详解

### 1. app.py - Flask主应用
**职责**：
- Web服务器启动和路由管理
- 文件上传处理
- 报告生成调度
- 报告导出接口
- 操作日志管理

**主要路由**：
- `/` - 首页
- `/upload` - 文件上传处理
- `/report/<id>` - 报告查看
- `/export/<id>/<format>` - 报告导出
- `/api/logs` - 操作日志查询
- `/api/system_info` - 系统信息

### 2. config.py - 配置管理
**职责**：
- 环境变量加载
- 系统参数配置
- 目录初始化

**主要配置**：
- 文件上传限制
- OpenAI API配置
- 目录路径配置

### 3. modules/data_processor.py - 数据处理
**职责**：
- Excel文件加载和解析
- 数据格式验证
- 年份自动检测
- 基本信息提取
- 财务数据提取

**核心类**：
- `DataProcessor` - 数据处理器

**主要方法**：
- `load_excel()` - 加载Excel文件
- `get_basic_info()` - 提取基本信息
- `get_financial_data()` - 获取财务数据
- `validate_data()` - 数据验证

### 4. modules/indicator_calculator.py - 指标计算
**职责**：
- 财务指标计算
- 四维度风险指标
- 两年数据对比

**核心类**：
- `IndicatorCalculator` - 指标计算器

**计算指标**：
- **盈利能力**：净利润率、毛利率、净资产收益率
- **偿债能力**：资产负债率、流动比率、速动比率
- **运营能力**：应收账款周转率、存货周转率、总资产周转率
- **现金流**：现金利润比、经营性净现金流、现金净增加额

### 5. modules/ai_analyzer.py - AI分析
**职责**：
- 调用OpenAI API
- 风险分析文本生成
- 默认分析逻辑
- 整体评估生成

**核心类**：
- `AIAnalyzer` - AI分析器

**主要方法**：
- `analyze_dimension_risk()` - 单维度风险分析
- `generate_overall_risk_assessment()` - 整体评估
- `_get_default_analysis()` - 默认分析（API不可用时）

### 6. modules/report_generator.py - 报告生成
**职责**：
- 整合所有分析结果
- 生成完整报告数据
- 报告数据管理

**核心类**：
- `ReportGenerator` - 报告生成器

**工作流程**：
1. 加载和验证数据
2. 提取基本信息
3. 计算财务指标
4. 生成AI分析
5. 组装报告数据

### 7. modules/export_generator.py - 报告导出
**职责**：
- Word格式导出
- PDF格式导出
- 报告格式化

**核心类**：
- `ExportGenerator` - 导出生成器

**支持格式**：
- DOCX（Word 2007+）
- PDF（A4规格）

## 前端界面说明

### templates/index.html - 首页
**功能**：
- 文件拖拽上传
- 进度显示
- 功能特点展示
- 操作日志展示

**技术**：
- Bootstrap 5布局
- 拖拽API
- Fetch API上传

### templates/report.html - 报告页
**功能**：
- 企业基本信息展示
- 总体风险评估
- 四维度风险分析
- 财务报表数据展示（标签页）
- 报告导出按钮

**技术**：
- Bootstrap 5组件
- 响应式设计
- Jinja2模板渲染

## 数据流程

```
用户上传Excel
    ↓
DataProcessor 解析数据
    ↓
IndicatorCalculator 计算指标
    ↓
AIAnalyzer 生成分析
    ↓
ReportGenerator 组装报告
    ↓
展示在Web页面
    ↓
ExportGenerator 导出文档
```

## 依赖关系

```
app.py
  ├── config.py
  ├── modules.report_generator
  │     ├── modules.data_processor
  │     ├── modules.indicator_calculator
  │     └── modules.ai_analyzer
  └── modules.export_generator
```

## 配置文件说明

### requirements.txt
列出所有Python依赖包及版本：
- Flask 3.0.0 - Web框架
- pandas 2.1.3 - 数据处理
- openpyxl 3.1.2 - Excel读写
- python-docx 1.1.0 - Word文档生成
- reportlab 4.0.7 - PDF生成
- openai 1.3.7 - AI接口
- python-dotenv 1.0.0 - 环境变量加载

### .env (需要创建)
环境变量配置：
```
OPENAI_API_KEY=your_key
OPENAI_API_BASE=https://api.openai.com/v1
SECRET_KEY=random_secret_key
```

### .gitignore
Git忽略规则：
- Python缓存文件
- 环境变量文件
- 上传和导出目录
- IDE配置文件

## 扩展开发指南

### 添加新的财务指标

1. 在 `indicator_calculator.py` 中添加计算方法
2. 在相应的维度方法中添加指标计算
3. 在 `report.html` 中添加显示逻辑

### 添加新的分析维度

1. 在 `indicator_calculator.py` 中创建新维度方法
2. 在 `ai_analyzer.py` 中添加分析逻辑
3. 在 `report_generator.py` 中整合新维度
4. 在前端模板中添加展示

### 集成其他AI模型

1. 修改 `ai_analyzer.py` 中的API调用
2. 调整提示词模板
3. 更新配置文件

### 添加数据库支持

1. 安装SQLAlchemy
2. 创建数据模型
3. 修改 `app.py` 中的数据存储逻辑
4. 添加数据查询接口

## 性能优化建议

1. **缓存机制**：缓存已计算的指标
2. **异步处理**：使用Celery处理耗时任务
3. **数据库**：使用数据库替代内存存储
4. **CDN**：静态资源使用CDN加速
5. **代码优化**：优化指标计算算法

## 安全注意事项

1. **文件上传**：已限制文件类型和大小
2. **API密钥**：使用环境变量，不要硬编码
3. **输入验证**：已进行基本数据验证
4. **生产部署**：
   - 关闭Debug模式
   - 使用HTTPS
   - 配置防火墙
   - 添加用户认证

---

**文档版本**：v1.0  
**更新日期**：2024年  
**维护团队**：AIFI项目组


