# AIFI智能财报系统 - 权限管理版 v2.0

## 🎉 新功能概述

本次更新实现了完整的**用户角色和权限管理系统**，将系统用户分为**管理员**和**普通用户**两个角色，实现了企业级的权限控制。

---

## ⚡ 快速开始

### 1. 启动系统
```bash
# Windows用户
双击运行: 启动系统.bat

# 或使用命令行
python app.py
```

### 2. 默认账号

#### 管理员账号 🛡️
```
URL: http://localhost:5000/login
用户名: admin
密码: admin123
```

#### 普通用户账号 👤
```
用户名: user
密码: user123

用户名: analyst  
密码: analyst123
```

---

## 🔐 核心功能

### 管理员功能
✅ 查看和管理所有用户  
✅ 添加、编辑、删除用户  
✅ 分配和修改用户角色  
✅ 启用/禁用用户账号  
✅ 查看所有用户的报告  
✅ 完整的系统统计面板  

### 普通用户功能
✅ 上传财务数据生成报告  
✅ 查看自己的报告  
✅ 导出自己的报告（Word/PDF）  
✅ 删除自己的报告  

---

## 📊 权限对比表

| 功能 | 管理员 | 普通用户 |
|-----|--------|---------|
| 用户管理 | ✅ | ❌ |
| 查看所有报告 | ✅ | ❌ |
| 查看自己报告 | ✅ | ✅ |
| 生成报告 | ✅ | ✅ |
| 导出报告 | ✅ | ✅ (仅自己) |
| 删除报告 | ✅ | ✅ (仅自己) |

---

## 🎯 核心特性

### 1. 完善的安全机制
- 🔒 密码加密存储（PBKDF2算法）
- 🔒 会话管理和权限验证
- 🔒 防止误操作的多重保护
- 🔒 账号状态管理（启用/禁用）

### 2. 智能保护规则
- ❌ 不能删除自己
- ❌ 不能修改自己的角色
- ❌ 不能禁用自己
- ❌ 不能删除最后一个管理员
- ❌ 不能降级最后一个管理员
- ❌ 用户名和邮箱唯一性验证

### 3. 数据持久化
- 💾 用户数据：`data/users.json`
- 💾 报告数据：`data/reports_storage.json`
- 💾 自动加载和保存
- 💾 重启后数据保留

### 4. 完整的操作日志
- 📝 用户登录/登出记录
- 📝 报告生成/导出/删除记录
- 📝 管理员操作记录
- 📝 权限变更记录

---

## 🎨 界面优化

### 角色标识
- 管理员：🛡️ 盾牌图标 + 红色管理员标签
- 普通用户：👤 人像图标 + 蓝色用户标签

### 动态菜单
- 管理员：显示"用户管理"菜单
- 普通用户：隐藏管理功能

### 美观的管理界面
- 📊 实时统计面板
- 📋 现代化的表格设计
- 🎨 渐变色彩方案
- 🎭 流畅的交互动画

---

## 📁 文件结构

```
项目根目录/
├── app.py                          # 主应用（新增管理员功能）
├── config.py                       # 配置文件
├── templates/
│   ├── login.html                 # 登录页面
│   ├── register.html              # 注册页面
│   ├── index.html                 # 首页（新增管理员菜单）
│   ├── reports_list.html          # 报告列表（权限区分）
│   └── admin_users.html           # 用户管理页面 ⭐ 新增
├── data/
│   ├── users.json                 # 用户数据 ⭐ 新增
│   └── reports_storage.json       # 报告数据
├── 用户权限管理说明.md             # 详细功能说明 ⭐ 新增
└── 管理员功能测试指南.md           # 测试指南 ⭐ 新增
```

---

## 🚀 使用流程

### 管理员使用流程
1. **登录** → 用admin账号登录
2. **用户管理** → 点击左侧"用户管理"菜单
3. **添加用户** → 点击"添加用户"按钮创建新账号
4. **权限管理** → 修改用户角色、启用/禁用账号
5. **查看报告** → 在报告列表中查看所有用户的报告

### 普通用户使用流程
1. **登录** → 用user账号登录或注册新账号
2. **上传数据** → 在首页上传Excel财务文件
3. **查看报告** → 系统自动生成并显示分析报告
4. **导出报告** → 将报告导出为Word或PDF格式
5. **管理报告** → 在报告列表中管理自己的报告

---

## 🔧 技术实现

### 后端
- **框架**: Flask
- **认证**: Flask Session + werkzeug.security
- **权限**: 装饰器模式（@login_required, @admin_required）
- **存储**: JSON文件（可扩展为数据库）

### 前端
- **UI框架**: Bootstrap 5
- **图标**: Bootstrap Icons
- **交互**: 原生JavaScript + Fetch API

---

## 📝 API接口

### 管理员专用API
```
GET  /admin/users                          # 用户管理页面
GET  /api/admin/users                      # 获取用户列表
POST /api/admin/users/add                  # 添加用户
POST /api/admin/users/edit/<username>      # 编辑用户
POST /api/admin/users/delete/<username>    # 删除用户
POST /api/admin/users/change_role/<username>    # 修改角色
POST /api/admin/users/toggle_status/<username>  # 启用/禁用
```

### 通用API
```
GET  /                             # 首页
GET  /reports                      # 报告列表
GET  /report/<report_id>           # 查看报告
POST /upload                       # 上传文件
POST /api/reports/delete/<id>     # 删除报告
GET  /export/<id>/<format>        # 导出报告
```

---

## ⚠️ 注意事项

### 安全建议
1. ✅ 首次部署后立即修改默认管理员密码
2. ✅ 定期备份 `data` 目录
3. ✅ 生产环境建议使用数据库替代JSON存储
4. ✅ 配置HTTPS加密传输
5. ✅ 设置强密码策略

### 系统维护
1. ✅ 保留至少2个管理员账号
2. ✅ 定期审查用户权限
3. ✅ 监控操作日志
4. ✅ 及时清理无效用户

---

## 📚 相关文档

1. **用户权限管理说明.md** - 详细的功能说明文档
2. **管理员功能测试指南.md** - 完整的测试步骤
3. **报告管理系统完整说明.md** - 系统整体说明
4. **项目结构说明.md** - 项目技术文档

---

## 🆕 版本历史

### v2.0 (2024-10-17)
- ✨ 新增：完整的用户权限管理系统
- ✨ 新增：管理员角色和普通用户角色区分
- ✨ 新增：用户增删改查功能
- ✨ 新增：权限分配和管理功能
- ✨ 新增：用户启用/禁用功能
- ✨ 新增：报告创建者信息记录
- ✨ 新增：管理员专用界面
- ✨ 新增：数据持久化支持
- 🔒 增强：多重安全保护机制
- 🎨 优化：界面角色标识
- 📝 新增：完整的操作日志

### v1.0
- 基础财报分析功能
- 报告生成和导出
- 简单的用户登录

---

## 🤝 技术支持

如有问题或建议，请参考：
- 📖 详细文档：`用户权限管理说明.md`
- 🧪 测试指南：`管理员功能测试指南.md`
- 💡 快速开始：`快速开始.txt`

---

## 🎓 下一步计划

### 短期计划
- [ ] 添加用户头像上传
- [ ] 增加更多操作日志类型
- [ ] 优化搜索和过滤功能
- [ ] 添加用户活动统计

### 长期计划
- [ ] 迁移到专业数据库（MySQL/PostgreSQL）
- [ ] 实现更细粒度的权限控制
- [ ] 添加用户组和团队功能
- [ ] 支持多因素认证（2FA）
- [ ] 添加审计日志系统

---

**开发团队**: AIFI Team  
**版本**: v2.0  
**更新日期**: 2024年10月17日  
**授权**: MIT License

---

🎉 **感谢使用 AIFI 智能财报系统！**


